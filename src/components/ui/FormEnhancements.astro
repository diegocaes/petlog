---
/**
 * Drop this component into any page to get:
 * 1. Submit button loading spinner on form submit
 * 2. Delete confirmation dialog before deleting
 */
---

<script>
  // 1. Loading state on submit buttons
  document.querySelectorAll<HTMLFormElement>('form[method="POST"]').forEach(form => {
    form.addEventListener('submit', (e) => {
      const action = form.querySelector<HTMLInputElement>('input[name="_action"]')?.value;

      // Skip delete forms — handled separately with confirmation
      if (action === 'delete') return;

      const submitBtn = form.querySelector<HTMLButtonElement>('button[type="submit"]');
      if (submitBtn && !submitBtn.classList.contains('btn-loading')) {
        submitBtn.classList.add('btn-loading');
        submitBtn.setAttribute('disabled', '');
      }
    });
  });

  // 2. Delete confirmation + haptic feedback
  document.querySelectorAll<HTMLFormElement>('form[method="POST"]').forEach(form => {
    const actionEl = form.querySelector<HTMLInputElement>('input[name="_action"]');
    const actionVal = actionEl?.value ?? '';
    if (!actionVal.includes('delete')) return;

    form.addEventListener('submit', (e) => {
      e.preventDefault();
      // Haptic on confirm prompt
      if ('vibrate' in navigator) navigator.vibrate(8);
      if (confirm('¿Eliminar este registro? Esta acción no se puede deshacer.')) {
        // Stronger haptic on confirm
        if ('vibrate' in navigator) navigator.vibrate([10, 50, 10]);
        const btn = form.querySelector<HTMLButtonElement>('button[type="submit"]');
        if (btn) {
          btn.classList.add('btn-loading');
          btn.setAttribute('disabled', '');
        }
        form.submit();
      }
    });
  });
</script>

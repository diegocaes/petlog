---
const currentPath = Astro.url.pathname;

const navItems = [
  { href: '/dashboard',     match: '/dashboard',    label: 'Inicio',   icon: 'home' },
  { href: '/salud/vacunas', match: '/salud',        label: 'Salud',    icon: 'heart' },
  { href: '/alimentacion',  match: '/alimentacion', label: 'Comida',   icon: 'food' },
  { href: '/viajes',        match: '/viajes',       label: 'Vuelos',   icon: 'plane' },
  { href: '/aventuras',     match: '/aventuras',    label: 'Fotos',    icon: 'camera' },
];

function isActive(match: string): boolean {
  if (match === '/dashboard') return currentPath === '/dashboard';
  return currentPath.startsWith(match);
}
---

<!-- â”€â”€â”€ DESKTOP SIDEBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<aside class="no-print hidden lg:flex flex-col fixed top-0 left-0 h-full w-55 bg-sidebar z-40">
  <!-- Logo -->
  <div class="flex items-center gap-3 px-5 py-5 border-b border-white/5">
    <div class="flex h-8 w-8 items-center justify-center rounded-lg bg-accent/20">
      <span class="text-base">ğŸ¾</span>
    </div>
    <span class="text-white font-bold text-base tracking-tight">PetLog</span>
  </div>

  <!-- Nav -->
  <nav class="flex-1 px-3 py-4 space-y-0.5">
    {navItems.map((item) => (
      <a href={item.href} class:list={['sidebar-link', isActive(item.match) && 'active']}>
        <svg class="h-4.5 w-4.5 shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" data-icon={item.icon}>
          <use href={`#sbi-${item.icon}`} />
        </svg>
        <span>{item.label}</span>
      </a>
    ))}
  </nav>

  <!-- Bottom: profile + logout -->
  <div class="px-3 py-4 border-t border-white/5 space-y-0.5">
    <a href="/perfil" class:list={['sidebar-link', isActive('/perfil') && 'active']}>
      <svg class="h-4.5 w-4.5 shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="8" r="4"/><path d="M4 20c0-4 3.6-7 8-7s8 3 8 7"/>
      </svg>
      <span>Perfil</span>
    </a>
  </div>
</aside>

<!-- â”€â”€â”€ MOBILE TOP BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<header class="no-print lg:hidden fixed top-0 left-0 right-0 z-40 flex items-center justify-between px-4 py-3 bg-sidebar border-b border-white/5">
  <div class="flex items-center gap-2.5">
    <div class="flex h-7 w-7 items-center justify-center rounded-lg bg-accent/20">
      <span class="text-sm">ğŸ¾</span>
    </div>
    <span class="text-white font-bold text-sm tracking-tight">PetLog</span>
  </div>
  <button
    id="mobile-menu-btn"
    type="button"
    class="flex h-9 w-9 items-center justify-center rounded-lg text-gray-400 hover:bg-sidebar-hover hover:text-white transition-colors"
    aria-label="MenÃº"
  >
    <svg id="menu-icon-open" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12h18M3 6h18M3 18h18"/></svg>
    <svg id="menu-icon-close" class="h-5 w-5 hidden" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6 6 18M6 6l12 12"/></svg>
  </button>
</header>

<!-- â”€â”€â”€ MOBILE DRAWER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div id="mobile-overlay" class="lg:hidden fixed inset-0 z-50 hidden">
  <!-- Backdrop -->
  <div id="mobile-backdrop" class="absolute inset-0 bg-black/60 backdrop-blur-sm"></div>

  <!-- Drawer -->
  <aside class="absolute top-0 left-0 h-full w-64 bg-sidebar flex flex-col translate-x-[-100%] transition-transform duration-300 ease-out" id="mobile-drawer">
    <!-- Logo -->
    <div class="flex items-center justify-between px-5 py-5 border-b border-white/5">
      <div class="flex items-center gap-2.5">
        <div class="flex h-7 w-7 items-center justify-center rounded-lg bg-accent/20">
          <span class="text-sm">ğŸ¾</span>
        </div>
        <span class="text-white font-bold text-sm tracking-tight">PetLog</span>
      </div>
    </div>

    <!-- Nav -->
    <nav class="flex-1 px-3 py-4 space-y-0.5">
      {navItems.map((item) => (
        <a href={item.href} class:list={['sidebar-link', isActive(item.match) && 'active']}>
          <svg class="h-4.5 w-4.5 shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
            <use href={`#sbi-${item.icon}`} />
          </svg>
          <span>{item.label}</span>
        </a>
      ))}
    </nav>

    <div class="px-3 py-4 border-t border-white/5">
      <a href="/perfil" class:list={['sidebar-link', isActive('/perfil') && 'active']}>
        <svg class="h-4.5 w-4.5 shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="8" r="4"/><path d="M4 20c0-4 3.6-7 8-7s8 3 8 7"/>
        </svg>
        <span>Perfil</span>
      </a>
    </div>
  </aside>
</div>

<!-- â”€â”€â”€ SVG ICON SPRITES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<svg class="hidden" xmlns="http://www.w3.org/2000/svg">
  <symbol id="sbi-home" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
    <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
    <polyline points="9 22 9 12 15 12 15 22"/>
  </symbol>
  <symbol id="sbi-heart" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
    <path d="M19.5 12.572l-7.5 7.428l-7.5-7.428a5 5 0 1 1 7.5-6.566a5 5 0 1 1 7.5 6.572"/>
    <path d="M3 12h4l2-3l4 6l2-3h4"/>
  </symbol>
  <symbol id="sbi-food" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
    <path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"/><path d="M7 2v20"/><path d="M21 15V2a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3v7"/>
  </symbol>
  <symbol id="sbi-plane" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
    <path d="M17.8 19.2 16 11l3.5-3.5C21 6 21.5 4 21 3c-1-.5-3 0-4.5 1.5L13 8 4.8 6.2c-.5-.1-.9.1-1.1.5l-.3.5c-.2.5-.1 1 .3 1.3L9 12l-2 3H4l-1 1 3 2 2 3 1-1v-3l3-2 3.5 5.3c.3.4.8.5 1.3.3l.5-.2c.4-.3.6-.7.5-1.2z"/>
  </symbol>
  <symbol id="sbi-camera" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
    <path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/>
    <circle cx="12" cy="13" r="3"/>
  </symbol>
</svg>

<script>
  function setupMobileMenu() {
    const btn = document.getElementById('mobile-menu-btn');
    const overlay = document.getElementById('mobile-overlay');
    const drawer = document.getElementById('mobile-drawer');
    const backdrop = document.getElementById('mobile-backdrop');
    const iconOpen = document.getElementById('menu-icon-open');
    const iconClose = document.getElementById('menu-icon-close');

    if (!btn || !overlay || !drawer) return;

    function open() {
      overlay!.classList.remove('hidden');
      requestAnimationFrame(() => {
        drawer!.style.transform = 'translateX(0)';
      });
      iconOpen!.classList.add('hidden');
      iconClose!.classList.remove('hidden');
    }

    function close() {
      drawer!.style.transform = 'translateX(-100%)';
      setTimeout(() => overlay!.classList.add('hidden'), 300);
      iconOpen!.classList.remove('hidden');
      iconClose!.classList.add('hidden');
    }

    btn.addEventListener('click', () => {
      overlay!.classList.contains('hidden') ? open() : close();
    });

    backdrop?.addEventListener('click', close);

    // Close on nav link click
    overlay?.querySelectorAll('a').forEach(a => {
      a.addEventListener('click', close);
    });
  }

  setupMobileMenu();
  document.addEventListener('astro:page-load', setupMobileMenu);
</script>
